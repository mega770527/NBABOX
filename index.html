<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>NBA 戰情中心 (NBA Live Dashboard)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* 自定義滾動條 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        /* 手機優化：隱藏多餘的點擊高亮 */
        * {
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 font-sans h-screen flex flex-col overflow-hidden">

    <!-- 頂部導航 -->
    <header class="bg-white shadow-sm z-10 flex-none h-16 flex items-center justify-between px-4 md:px-6 safe-top">
        <div class="flex items-center gap-3 md:gap-4">
            <!-- [修改] 更換為 NBA 官方 Logo -->
            <img src="https://cdn.nba.com/logos/leagues/logo-nba.svg" alt="NBA Logo" class="h-5 md:h-10 w-auto object-contain">
            <h1 class="text-lg md:text-xl font-bold tracking-tight text-slate-900 truncate">NBA 戰情中心</h1>
            <span id="currentDate" class="hidden md:inline-block text-sm text-slate-500 bg-slate-100 px-2 py-1 rounded ml-2">載入中...</span>
        </div>
        <div class="flex items-center gap-2 md:gap-3">
            <button onclick="fetchGames()" class="flex items-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition text-sm font-medium shadow-sm active:scale-95">
                <i class="fa-solid fa-rotate-right"></i> <span class="hidden md:inline">重新整理</span>
            </button>
            <button onclick="toggleView('list')" id="backButton" class="md:hidden hidden px-3 py-2 bg-slate-200 text-slate-700 rounded-lg text-sm font-medium">
                <i class="fa-solid fa-chevron-left"></i> 列表
            </button>
        </div>
    </header>

    <!-- 主內容區 -->
    <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
        
        <!-- 左側：賽事列表 (手機版時佔滿全螢幕，選擇後隱藏) -->
        <aside id="gamesPanel" class="w-full md:w-80 lg:w-96 bg-white border-r border-slate-200 flex flex-col flex-none z-10 absolute inset-0 md:relative transition-transform duration-300 transform translate-x-0">
            <div class="p-3 md:p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <h2 class="font-semibold text-slate-700">今日賽程 (<span id="gameCount">0</span>)</h2>
                    <!-- [新增] 下載 JSON 按鈕 -->
                    <button onclick="downloadAllData()" id="downloadBtn" title="下載完整 JSON 數據" class="w-8 h-8 flex items-center justify-center rounded-full bg-white border border-slate-200 text-slate-500 hover:text-blue-600 hover:border-blue-300 transition shadow-sm ml-2 active:scale-90">
                        <i class="fa-solid fa-download text-xs"></i>
                    </button>
                </div>
                <span id="mobileDate" class="md:hidden text-xs text-slate-500 bg-white px-2 py-1 rounded border"></span>
            </div>
            <div id="gamesList" class="flex-1 overflow-y-auto p-2 space-y-2 pb-20 md:pb-2">
                <!-- 賽事卡片將插入此處 -->
                <div class="flex flex-col items-center justify-center h-40 text-slate-400">
                    <div class="loader mb-2"></div>
                    <p>正在載入賽事數據...</p>
                </div>
            </div>
        </aside>

        <!-- 右側：詳細數據 (Box Score) -->
        <section id="detailPanel" class="w-full h-full flex flex-col bg-slate-100 absolute inset-0 md:relative z-20 md:z-0 transition-transform duration-300 transform translate-x-full md:translate-x-0 bg-slate-100">
            
            <!-- 歡迎畫面 (電腦版未選擇比賽時顯示) -->
            <div id="welcomeScreen" class="absolute inset-0 flex flex-col items-center justify-center text-slate-400 hidden md:flex">
                <!-- 這裡也換成一個較淡的 NBA Logo -->
                <img src="https://cdn.nba.com/logos/leagues/logo-nba.svg" class="h-32 w-auto opacity-10 mb-4 grayscale">
                <p class="text-lg">請從左側選擇一場比賽以查看詳細 Box Score</p>
            </div>

            <!-- 數據內容區 -->
            <div id="detailContent" class="hidden flex flex-col h-full w-full">
                
                <!-- 1. 比賽資訊頭部 (比分板) -->
                <div class="bg-white p-4 md:p-6 shadow-sm border-b border-slate-200 flex-none sticky top-0 z-30">
                    <div class="max-w-4xl mx-auto flex items-center justify-between">
                        
                        <!-- 客隊 -->
                        <div class="flex flex-col items-center flex-1">
                            <img id="teamLogo1" src="" class="w-12 h-12 md:w-20 md:h-20 object-contain mb-1 md:mb-2" alt="Away Logo">
                            <h2 id="teamName1" class="text-sm md:text-xl font-bold text-slate-800 text-center leading-tight">Team A</h2>
                            <p id="teamRecord1" class="text-xs text-slate-500 hidden md:block">-</p>
                        </div>

                        <!-- 比分與狀態 -->
                        <div class="flex flex-col items-center justify-center px-2 md:px-8">
                            <div class="text-2xl md:text-4xl font-black text-slate-900 tracking-wider flex gap-2 md:gap-4">
                                <span id="score1">0</span>
                                <span class="text-slate-300">-</span>
                                <span id="score2">0</span>
                            </div>
                            <div id="gameStatus" class="mt-1 md:mt-2 px-2 md:px-3 py-0.5 md:py-1 bg-slate-100 text-slate-600 rounded-full text-[10px] md:text-xs font-bold uppercase tracking-wide whitespace-nowrap">
                                FINAL
                            </div>
                        </div>

                        <!-- 主隊 -->
                        <div class="flex flex-col items-center flex-1">
                            <img id="teamLogo2" src="" class="w-12 h-12 md:w-20 md:h-20 object-contain mb-1 md:mb-2" alt="Home Logo">
                            <h2 id="teamName2" class="text-sm md:text-xl font-bold text-slate-800 text-center leading-tight">Team B</h2>
                            <p id="teamRecord2" class="text-xs text-slate-500 hidden md:block">-</p>
                        </div>
                    </div>
                </div>

                <!-- 2. 數據表格區域 -->
                <div class="flex-1 overflow-y-auto p-2 md:p-8 pb-20 md:pb-8">
                    <div class="max-w-6xl mx-auto space-y-4 md:space-y-8">
                        
                        <!-- 客隊數據 -->
                        <div class="glass-panel rounded-xl shadow-sm overflow-hidden bg-white">
                            <div class="px-4 py-3 md:px-6 md:py-4 border-b border-slate-100 bg-slate-50/50 flex items-center gap-2">
                                <img id="smallLogo1" src="" class="w-5 h-5 md:w-6 md:h-6">
                                <h3 id="tableTitle1" class="font-bold text-sm md:text-base text-slate-700">Away Stats</h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left whitespace-nowrap">
                                    <thead class="bg-slate-50 text-slate-500 uppercase text-xs font-semibold">
                                        <tr>
                                            <th class="px-3 md:px-4 py-2 md:py-3 sticky left-0 bg-slate-50 z-10 border-r border-slate-100 w-32 md:w-48 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">Player</th>
                                            <th class="px-2 py-3 text-center">MIN</th>
                                            <th class="px-2 py-3 text-center font-bold text-slate-700 bg-blue-50/50">PTS</th>
                                            <th class="px-2 py-3 text-center">REB</th>
                                            <th class="px-2 py-3 text-center">AST</th>
                                            <th class="px-2 py-3 text-center">STL</th>
                                            <th class="px-2 py-3 text-center">BLK</th>
                                            <th class="px-2 py-3 text-center">TO</th>
                                            <th class="px-2 py-3 text-center">FG</th>
                                            <th class="px-2 py-3 text-center">3PT</th>
                                            <th class="px-2 py-3 text-center">FT</th>
                                            <th class="px-2 py-3 text-center">+/-</th>
                                        </tr>
                                    </thead>
                                    <tbody id="statsBody1" class="divide-y divide-slate-100"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 主隊數據 -->
                        <div class="glass-panel rounded-xl shadow-sm overflow-hidden bg-white">
                            <div class="px-4 py-3 md:px-6 md:py-4 border-b border-slate-100 bg-slate-50/50 flex items-center gap-2">
                                <img id="smallLogo2" src="" class="w-5 h-5 md:w-6 md:h-6">
                                <h3 id="tableTitle2" class="font-bold text-sm md:text-base text-slate-700">Home Stats</h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left whitespace-nowrap">
                                    <thead class="bg-slate-50 text-slate-500 uppercase text-xs font-semibold">
                                        <tr>
                                            <th class="px-3 md:px-4 py-2 md:py-3 sticky left-0 bg-slate-50 z-10 border-r border-slate-100 w-32 md:w-48 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">Player</th>
                                            <th class="px-2 py-3 text-center">MIN</th>
                                            <th class="px-2 py-3 text-center font-bold text-slate-700 bg-blue-50/50">PTS</th>
                                            <th class="px-2 py-3 text-center">REB</th>
                                            <th class="px-2 py-3 text-center">AST</th>
                                            <th class="px-2 py-3 text-center">STL</th>
                                            <th class="px-2 py-3 text-center">BLK</th>
                                            <th class="px-2 py-3 text-center">TO</th>
                                            <th class="px-2 py-3 text-center">FG</th>
                                            <th class="px-2 py-3 text-center">3PT</th>
                                            <th class="px-2 py-3 text-center">FT</th>
                                            <th class="px-2 py-3 text-center">+/-</th>
                                        </tr>
                                    </thead>
                                    <tbody id="statsBody2" class="divide-y divide-slate-100"></tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                    <div class="h-10"></div> <!-- Spacer -->
                </div>
            </div>
            
            <!-- 載入指示器 -->
            <div id="detailLoader" class="hidden absolute inset-0 bg-white/80 backdrop-blur-sm z-50 flex items-center justify-center">
                <div class="loader"></div>
            </div>

        </section>
    </main>

    <script>
        // --- 設定與對照表 ---
        const DEFAULT_LABELS = ["MIN", "FG", "3PT", "FT", "OREB", "DREB", "REB", "AST", "STL", "BLK", "TO", "PF", "+/-", "PTS"];
        
        let allGames = [];
        let currentGameId = null;

        // --- 手機版視圖切換邏輯 ---
        function toggleView(view) {
            const gamesPanel = document.getElementById('gamesPanel');
            const detailPanel = document.getElementById('detailPanel');
            const backButton = document.getElementById('backButton');
            
            if (window.innerWidth >= 768) {
                gamesPanel.style.transform = '';
                detailPanel.style.transform = '';
                backButton.classList.add('hidden');
                return;
            }

            if (view === 'detail') {
                gamesPanel.classList.add('-translate-x-full');
                detailPanel.classList.remove('translate-x-full');
                backButton.classList.remove('hidden');
            } else {
                gamesPanel.classList.remove('-translate-x-full');
                detailPanel.classList.add('translate-x-full');
                backButton.classList.add('hidden');
            }
        }

        window.addEventListener('resize', () => {
             if (window.innerWidth >= 768) {
                document.getElementById('gamesPanel').style.transform = '';
                document.getElementById('detailPanel').style.transform = '';
                document.getElementById('gamesPanel').classList.remove('-translate-x-full');
                document.getElementById('detailPanel').classList.remove('translate-x-full');
                document.getElementById('backButton').classList.add('hidden');
             } else {
                if (currentGameId) {
                    toggleView('detail');
                } else {
                    toggleView('list');
                }
             }
        });

        // --- 強化的 API 呼叫函式 (含 CORS Proxy) ---
        async function fetchWithFallback(url) {
            try {
                const res = await fetch(url);
                if (!res.ok) throw new Error('Direct fetch failed');
                return await res.json();
            } catch (e) {
                console.warn("直接連線失敗 (可能因 CORS)，嘗試使用代理...", e);
                try {
                    const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
                    const resProxy = await fetch(proxyUrl);
                    if (!resProxy.ok) throw new Error('Proxy fetch failed');
                    return await resProxy.json();
                } catch (e2) {
                    console.error("代理連線也失敗:", e2);
                    throw e2;
                }
            }
        }

        async function fetchGames() {
            const listEl = document.getElementById('gamesList');
            if(listEl.children.length === 0 || listEl.querySelector('.loader')) {
                listEl.innerHTML = '<div class="flex flex-col items-center justify-center h-40 text-slate-400"><div class="loader mb-2"></div><p>正在載入賽事數據...</p></div>';
            }

            const url = "https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard";

            try {
                const data = await fetchWithFallback(url);
                
                if (data.day && data.day.date) {
                    document.getElementById('currentDate').textContent = data.day.date;
                    document.getElementById('mobileDate').textContent = data.day.date;
                }

                const events = data.events || [];
                document.getElementById('gameCount').textContent = events.length;

                allGames = events.map(event => {
                    const statusDesc = event.status?.type?.description || "Scheduled";
                    const shortStatus = event.status?.type?.shortDetail || statusDesc;
                    const isLive = event.status?.type?.state === 'in';
                    const isFinal = event.status?.type?.state === 'post';

                    const competitions = event.competitions?.[0] || {};
                    const competitors = competitions.competitors || [];
                    
                    let quickScore = {};
                    let teams = [];

                    competitors.forEach(comp => {
                        const abbr = comp.team?.abbreviation;
                        const score = comp.score || "0";
                        quickScore[abbr] = score;
                        teams.push({
                            id: comp.id,
                            name: comp.team?.displayName,
                            shortName: comp.team?.name,
                            abbr: abbr,
                            logo: comp.team?.logo || 'https://via.placeholder.com/50?text=NBA',
                            score: score,
                            color: comp.team?.color || '000000',
                            record: comp.records?.[0]?.summary || '-'
                        });
                    });

                    let homeTeam = teams.find(t => competitors.find(c => c.team.abbreviation === t.abbr)?.homeAway === 'home') || teams[0];
                    let awayTeam = teams.find(t => competitors.find(c => c.team.abbreviation === t.abbr)?.homeAway === 'away') || teams[1];

                    return {
                        id: event.id,
                        name: event.name,
                        status: statusDesc,
                        shortStatus: shortStatus,
                        isLive: isLive,
                        isFinal: isFinal,
                        away: awayTeam,
                        home: homeTeam,
                        quick_score: quickScore
                    };
                });

                renderGamesList();

            } catch (error) {
                console.error("Fetch Games Error:", error);
                listEl.innerHTML = `<div class="p-4 text-center text-red-500"><i class="fa-solid fa-triangle-exclamation mb-2"></i><br>載入失敗，請檢查網路連線</div>`;
            }
        }

        async function fetchGameDetails(gameId) {
            const loader = document.getElementById('detailLoader');
            loader.classList.remove('hidden');

            const basicGameInfo = allGames.find(g => g.id === gameId);
            const url = `https://site.api.espn.com/apis/site/v2/sports/basketball/nba/summary?event=${gameId}`;

            try {
                const data = await fetchWithFallback(url);
                const boxscore = data.boxscore || {};
                
                document.getElementById('welcomeScreen').classList.add('hidden');
                document.getElementById('detailContent').classList.remove('hidden');
                
                toggleView('detail');

                renderHeader(basicGameInfo, boxscore);
                renderStatsTable(boxscore);

            } catch (error) {
                console.error("Fetch Details Error:", error);
                alert("無法取得該場比賽的詳細數據，可能尚無數據。");
            } finally {
                loader.classList.add('hidden');
            }
        }

        // --- 下載完整 JSON 功能 ---
        async function downloadAllData() {
            if (!allGames || allGames.length === 0) {
                alert("目前沒有賽事資料可供下載");
                return;
            }

            // 改變按鈕圖示顯示為 Loading
            const btnIcon = document.querySelector('#downloadBtn i');
            const originalClass = btnIcon.className;
            btnIcon.className = "fa-solid fa-spinner fa-spin";
            
            const btn = document.getElementById('downloadBtn');
            btn.disabled = true;

            try {
                const allFullData = [];
                // 為了避免過度請求，我們每次請求間隔一點時間
                for (const game of allGames) {
                    let details = {};
                    try {
                        const url = `https://site.api.espn.com/apis/site/v2/sports/basketball/nba/summary?event=${game.id}`;
                        const data = await fetchWithFallback(url);
                        details = data.boxscore || {};
                    } catch (e) {
                        console.warn(`無法取得 ${game.name} 的詳細資料`, e);
                    }

                    allFullData.push({
                        "basic_info": game,
                        "box_score": details
                    });

                    // 稍微停頓 200ms
                    await new Promise(r => setTimeout(r, 200));
                }

                // 產生 JSON 檔案
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(allFullData, null, 4));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                const dateStr = new Date().toISOString().split('T')[0];
                downloadAnchorNode.setAttribute("download", `NBA_Data_${dateStr}.json`);
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();

            } catch (error) {
                console.error("Download failed", error);
                alert("下載過程中發生錯誤");
            } finally {
                // 恢復按鈕狀態
                btnIcon.className = originalClass;
                btn.disabled = false;
            }
        }

        // --- 渲染 UI 函式 ---

        function renderGamesList() {
            const listEl = document.getElementById('gamesList');
            listEl.innerHTML = '';

            if (allGames.length === 0) {
                listEl.innerHTML = '<div class="p-4 text-center text-slate-500">今日無賽事</div>';
                return;
            }

            allGames.forEach(game => {
                const card = document.createElement('div');
                const isActive = game.id === currentGameId;
                
                card.className = `cursor-pointer p-3 md:p-4 rounded-xl border transition duration-200 active:scale-98 ${
                    isActive 
                    ? 'bg-blue-50 border-blue-500 ring-1 ring-blue-500 shadow-sm' 
                    : 'bg-white border-slate-200 hover:border-blue-300'
                }`;
                
                let statusColor = "text-slate-500 bg-slate-100";
                if (game.isLive) statusColor = "text-red-600 bg-red-50 animate-pulse border border-red-100";
                if (game.isFinal) statusColor = "text-slate-800 font-bold bg-slate-200";

                card.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-[10px] md:text-xs font-semibold px-2 py-0.5 rounded ${statusColor}">
                            ${game.shortStatus}
                        </span>
                    </div>
                    
                    <div class="flex justify-between items-center mb-1">
                        <div class="flex items-center gap-2 md:gap-3">
                            <img src="${game.away.logo}" class="w-6 h-6 md:w-8 md:h-8 object-contain">
                            <span class="font-bold text-slate-700 text-sm md:text-base">${game.away.abbr}</span>
                        </div>
                        <span class="text-base md:text-lg font-bold text-slate-900">${game.away.score}</span>
                    </div>

                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-2 md:gap-3">
                            <img src="${game.home.logo}" class="w-6 h-6 md:w-8 md:h-8 object-contain">
                            <span class="font-bold text-slate-700 text-sm md:text-base">${game.home.abbr}</span>
                        </div>
                        <span class="text-base md:text-lg font-bold text-slate-900">${game.home.score}</span>
                    </div>
                `;

                card.onclick = () => {
                    currentGameId = game.id;
                    renderGamesList(); 
                    fetchGameDetails(game.id);
                };

                listEl.appendChild(card);
            });
        }

        function renderHeader(basicInfo, boxscore) {
            const away = basicInfo.away;
            const home = basicInfo.home;
            const scoreAway = away.score;
            const scoreHome = home.score;

            document.getElementById('teamName1').textContent = away.name;
            document.getElementById('teamLogo1').src = away.logo;
            document.getElementById('teamRecord1').textContent = away.record;
            document.getElementById('score1').textContent = scoreAway;

            document.getElementById('teamName2').textContent = home.name;
            document.getElementById('teamLogo2').src = home.logo;
            document.getElementById('teamRecord2').textContent = home.record;
            document.getElementById('score2').textContent = scoreHome;

            document.getElementById('smallLogo1').src = away.logo;
            document.getElementById('smallLogo2').src = home.logo;
            document.getElementById('tableTitle1').textContent = away.abbr;
            document.getElementById('tableTitle2').textContent = home.abbr;

            document.getElementById('gameStatus').textContent = basicInfo.shortStatus;
        }

        function renderStatsTable(boxscore) {
            const playerSections = boxscore.players || [];
            
            document.getElementById('statsBody1').innerHTML = '';
            document.getElementById('statsBody2').innerHTML = '';

            if (playerSections.length < 2) {
                const emptyMsg = '<tr><td colspan="12" class="p-4 text-center text-slate-400">尚無詳細數據</td></tr>';
                document.getElementById('statsBody1').innerHTML = emptyMsg;
                document.getElementById('statsBody2').innerHTML = emptyMsg;
                return;
            }

            const basicGame = allGames.find(g => g.id === currentGameId);

            playerSections.forEach(section => {
                const teamId = section.team?.id;
                const isAway = teamId === basicGame.away.id;
                const targetBodyId = isAway ? 'statsBody1' : 'statsBody2';
                const tbody = document.getElementById(targetBodyId);

                const statsMeta = section.statistics?.[0] || {};
                const labels = statsMeta.names || DEFAULT_LABELS;
                const athletes = statsMeta.athletes || [];

                athletes.forEach(athlete => {
                    const row = document.createElement('tr');
                    row.className = "hover:bg-blue-50/50 transition border-b border-slate-50 last:border-0";
                    
                    const pName = athlete.athlete?.displayName || "Unknown";
                    const pPos = athlete.athlete?.position?.abbreviation || "";
                    const pJersey = athlete.athlete?.jersey || "";
                    const reason = athlete.reason; 
                    const didNotPlay = athlete.didNotPlay;
                    const statsArr = athlete.stats || [];

                    const playerCell = `
                        <td class="px-3 md:px-4 py-2 md:py-3 sticky left-0 bg-white group-hover:bg-blue-50 border-r border-slate-100 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.05)]">
                            <div class="flex items-center gap-2">
                                <span class="font-medium text-slate-800 whitespace-nowrap text-xs md:text-sm truncate max-w-[80px] md:max-w-none">${pName}</span>
                                <span class="text-[10px] md:text-xs text-slate-400">${pPos}</span>
                            </div>
                        </td>
                    `;

                    if (didNotPlay) {
                        row.innerHTML = `
                            ${playerCell}
                            <td colspan="11" class="px-2 py-3 text-left text-slate-400 italic pl-4 text-xs">
                                ${reason || "DNP"}
                            </td>
                        `;
                    } else {
                        let statsMap = {};
                        labels.forEach((label, idx) => {
                            statsMap[label] = statsArr[idx];
                        });
                        const s = (key) => statsMap[key] || "-";

                        row.innerHTML = `
                            ${playerCell}
                            <td class="px-2 py-3 text-center font-mono text-slate-600 text-xs md:text-sm">${s("MIN")}</td>
                            <td class="px-2 py-3 text-center font-mono font-bold text-slate-900 bg-blue-50/30 text-xs md:text-sm">${s("PTS")}</td>
                            <td class="px-2 py-3 text-center font-mono text-slate-600 text-xs md:text-sm">${s("REB")}</td>
                            <td class="px-2 py-3 text-center font-mono text-slate-600 text-xs md:text-sm">${s("AST")}</td>
                            <td class="px-2 py-3 text-center font-mono text-slate-600 text-xs md:text-sm">${s("STL")}</td>
                            <td class="px-2 py-3 text-center font-mono text-slate-600 text-xs md:text-sm">${s("BLK")}</td>
                            <td class="px-2 py-3 text-center font-mono text-slate-600 text-xs md:text-sm">${s("TO")}</td>
                            <td class="px-2 py-3 text-center font-mono text-slate-600 text-xs md:text-sm">${s("FG")}</td>
                            <td class="px-2 py-3 text-center font-mono text-slate-600 text-xs md:text-sm">${s("3PT")}</td>
                            <td class="px-2 py-3 text-center font-mono text-slate-600 text-xs md:text-sm">${s("FT")}</td>
                            <td class="px-2 py-3 text-center font-mono text-xs md:text-sm ${parseInt(s("+/-")) > 0 ? 'text-green-600' : (parseInt(s("+/-")) < 0 ? 'text-red-600' : 'text-slate-400')}">${s("+/-")}</td>
                        `;
                    }
                    tbody.appendChild(row);
                });
            });
        }

        window.onload = () => {
            fetchGames();
            setInterval(fetchGames, 60000);
            
            if (window.innerWidth < 768) {
                toggleView('list');
            }
        };

    </script>
</body>
</html>